<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.exoplatform.platform</groupId>
		<artifactId>platform-packaging</artifactId>
		<version>4.0.0-SNAPSHOT</version>
	</parent>
	<artifactId>platform-packaging-jbossears</artifactId>
	<packaging>pom</packaging>
	<name>eXo Platform - Packaging JBossEAP EARs</name>

	<profiles>
		<profile>
			<id>distrib</id>
			<dependencies>
				<dependency>
					<groupId>org.exoplatform.platform</groupId>
					<artifactId>platform-packaging-commons</artifactId>
					<type>zip</type>
				</dependency>
				<dependency>
					<groupId>org.exoplatform.platform</groupId>
					<artifactId>platform-server-jboss-patch</artifactId>
				</dependency>
			</dependencies>
			<build>
				<finalName>eXo-Platform-jboss-${project.version}</finalName>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-dependency-plugin</artifactId>
						<executions>
							<!-- Extract gatein.ear and the jboss server patch -->
							<execution>
								<id>01-ears-unpack-dependencies</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>unpack</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/jboss/server/default/deploy</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>org.gatein.portal</groupId>
											<artifactId>exo.portal.packaging.assembly</artifactId>
											<classifier>jboss-ear</classifier>
											<type>zip</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.platform</groupId>
											<artifactId>platform-server-jboss-patch</artifactId>
											<type>jar</type>
											<outputDirectory>${project.build.directory}/jboss</outputDirectory>
											<excludes>META-INF/</excludes>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.platform</groupId>
											<artifactId>platform-packaging-commons</artifactId>
											<type>zip</type>
											<outputDirectory>target/commons</outputDirectory>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
							<!-- Copy the EARs to jboss/server/default/deploy -->
							<execution>
								<id>02-ears-copy-ears</id>
								<phase>prepare-package</phase>
								<goals>
									<goal>copy</goal>
								</goals>
								<configuration>
									<outputDirectory>${project.build.directory}/jboss/server/default/deploy</outputDirectory>
									<artifactItems>
										<artifactItem>
											<groupId>org.gatein.integration</groupId>
											<artifactId>extension-ear-as5</artifactId>
											<destFileName>gatein-wsrp-extension-${org.gatein.portal.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>										
										<artifactItem>
											<groupId>org.gatein.portal</groupId>
											<artifactId>starter-gatein</artifactId>
											<destFileName>starter-gatein-${org.gatein.portal.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.calendar</groupId>
											<artifactId>calendar-extension-ear</artifactId>
											<destFileName>exo-collaboration-extension-${org.exoplatform.calendar.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.ecms</groupId>
											<artifactId>ecms-packaging-wcm-ear</artifactId>
											<destFileName>exo-wcm-extension-${org.exoplatform.ecms.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.forum</groupId>
											<artifactId>forum-extension-ear</artifactId>
											<destFileName>exo-forum-extension-${org.exoplatform.forum.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.platform</groupId>
											<artifactId>platform-extension-ear</artifactId>
											<destFileName>exo-platform-extension-${project.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.platform</groupId>
											<artifactId>platform-sample-acme-website-ear</artifactId>
											<destFileName>exo-acme-website-${project.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.platform</groupId>
											<artifactId>platform-sample-default-website-ear</artifactId>
											<destFileName>exo-default-portal-${project.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.platform</groupId>
											<artifactId>platform-sample-acme-intranet-ear</artifactId>
											<destFileName>exo-social-intranet-${project.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.social</groupId>
											<artifactId>social-extension-ear</artifactId>
											<destFileName>exo-social-extension-${org.exoplatform.social.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
										<artifactItem>
											<groupId>org.exoplatform.platform</groupId>
											<artifactId>platform-exo-gadget-pack-ear</artifactId>
											<destFileName>exo-gadget-pack-${project.version}.ear</destFileName>
											<type>ear</type>
										</artifactItem>
									</artifactItems>
								</configuration>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<artifactId>maven-assembly-plugin</artifactId>
						<executions>
							<execution>
								<id>assembly</id>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>src/main/assembly/ears-archive.xml</descriptor>
									</descriptors>
									<appendAssemblyId>false</appendAssemblyId>
								</configuration>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>
</project>
